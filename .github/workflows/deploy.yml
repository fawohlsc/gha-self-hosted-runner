name: Deploy GitHub Runner to Azure

on:
#  repository_dispatch
 push:
    branches:
      - master

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:  
    - name: "Checkout GitHub repository"
      uses: actions/checkout@v2
    - name: "Login to Azure"
      uses: azure/login@v1
      with:
        creds: ${{secrets.AZURE_CREDENTIALS}}
    - name: Deploy GitHub Runner to Azure
      uses: azure/CLI@v1
      with:
        inlineScript: |
          chmod +x $GITHUB_WORKSPACE/deploy.sh
          $GITHUB_WORKSPACE/deploy.sh
      env:
        RG_NAME: "github-runner-${{github.run_number}}"
        RG_LOCATION: "WestEurope"
        GH_TOKEN: ${{secrets.GH_TOKEN_REPO}}
    